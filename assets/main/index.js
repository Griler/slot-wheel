System.register("chunks:///_virtual/main",["./ReelController.ts","./RingController.ts","./SlotGameManager.ts"],(function(){return{setters:[null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/ReelController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,s,n,o,r,a,p,h,l,d,_,u,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.createForOfIteratorHelperLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,p=t.Node,h=t.Prefab,l=t.instantiate,d=t.Sprite,_=t.tween,u=t.v3,c=t.Component}],execute:function(){var f,m,y,g,S,b,v,N,R;r._RF.push({},"99b6cxEdmJB8KKYIzVB3Cq0","ReelController",void 0);var K=a.ccclass,C=a.property;t("ReelController",(f=K("ReelController"),m=C(p),y=C(p),g=C(h),f((v=e((b=function(t){function e(){for(var e,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return e=t.call.apply(t,[this].concat(s))||this,n(e,"reelStrip",v,o(e)),n(e,"maskNode",N,o(e)),n(e,"symbolPrefab",R,o(e)),e._spriteMap={},e._spriteKeys=[],e._itemHeight=0,e._nodes=[],e.TOTAL_NODES=5,e._speed=0,e._maxSpeed=2e3,e.isStopped=!0,e._stopping=!1,e._targetKey="",e._finalNode=null,e}i(e,t);var r=e.prototype;return r.initReel=function(t){this.isStopped=!0,this._finalNode=null,this._itemHeight=200,this._spriteMap=t.reduce((function(t,e){return e&&(t[e.name]=e),t}),{}),this._spriteKeys=t.map((function(t){return t.name})),this.reelStrip.destroyAllChildren(),this._nodes=[];for(var e=0;e<this.TOTAL_NODES;e++){var i=(2-e)*this._itemHeight,s=this.spawnNode(i);this._nodes.push(s),this.setRandomSprite(s)}},r.spawnNode=function(t){var e=l(this.symbolPrefab);return e.setPosition(0,t,0),this.reelStrip.addChild(e),e},r.setRandomSprite=function(t){var e=Math.floor(Math.random()*this._spriteKeys.length),i=this._spriteKeys[e];t.getComponent(d).spriteFrame=this._spriteMap[i],t.name=i},r.startSpin=function(){this.isStopped&&(this.isStopped=!1,this._stopping=!1,this._finalNode=null,this._speed=0,_(this).to(.5,{_speed:this._maxSpeed},{easing:"cubicIn"}).start())},r.stopAt=function(t){this._targetKey="icon ("+t+")",this._spriteMap[this._targetKey]&&(this._stopping=!0)},r.update=function(t){if(!this.isStopped){for(var e=this._speed*t,i=0;i<this._nodes.length;i++){var s=this._nodes[i],n=s.position.y-e;s.setPosition(0,n,0)}this.checkResetNodes(),this._finalNode&&this.handleFinalLanding()}},r.checkResetNodes=function(){for(var t=-2.5*this._itemHeight,e=0;e<this._nodes.length;e++){var i=this._nodes[e];if(i.position.y<t){var s=i.position.y+this.TOTAL_NODES*this._itemHeight;i.setPosition(0,s,0),this._stopping&&!this._finalNode?(i.getComponent(d).spriteFrame=this._spriteMap[this._targetKey],i.name=this._targetKey,this._finalNode=i,this._speed=.5*this._maxSpeed):this.setRandomSprite(i)}}},r.handleFinalLanding=function(){if(this._finalNode){var t=this._finalNode.position.y;t<=0?(this.isStopped=!0,this._speed=0,this.forceSnapToGrid(),_(this.reelStrip).by(.1,{position:u(0,-10,0)}).by(.1,{position:u(0,10,0)}).start()):t<3*this._itemHeight&&(this._speed=Math.max(100,5*t))}},r.forceSnapToGrid=function(){if(this._finalNode)for(var t,e=0-this._finalNode.position.y,i=s(this._nodes);!(t=i()).done;){var n=t.value;n.setPosition(0,n.position.y+e,0)}},e}(c)).prototype,"reelStrip",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(b.prototype,"maskNode",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(b.prototype,"symbolPrefab",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=b))||S));r._RF.pop()}}}));

System.register("chunks:///_virtual/RingController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,r,o,s,a,h,l,p,u,d;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){o=t.cclegacy,s=t._decorator,a=t.Node,h=t.Sprite,l=t.Tween,p=t.tween,u=t.Color,d=t.Component}],execute:function(){var g,c,f,_,m,v,y;o._RF.push({},"bf3a4NvKQdEyKnJZho4VjAt","RingController",void 0);var x=s.ccclass,I=s.property;t("RingController",(g=x("RingController"),c=I({type:[a]}),f=I(),g((v=e((m=function(t){function e(){for(var e,i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return e=t.call.apply(t,[this].concat(o))||this,n(e,"ringNodes",v,r(e)),n(e,"fadeDuration",y,r(e)),e.currentIndex=0,e._timer=0,e._speed=.1,e._targetIndex=-1,e._isSpinning=!1,e._waitForReel=!1,e._onFinished=null,e}i(e,t);var o=e.prototype;return o.initItems=function(t){var e=this.ringNodes.length,i=t.length;if(0!==e&&0!==i){for(var n=[],r=0;r<i;r++)n.length<e&&n.push(r);for(;n.length<e;)n.push(Math.floor(Math.random()*i));this.shuffleArray(n);for(var o=0;o<e;o++){var s=this.ringNodes[o],a=s.getComponent(h);a||(a=s.addComponent(h)),a.spriteFrame=t[n[o]]}}},o.startSpin=function(){this._isSpinning=!0,this._waitForReel=!1,this._targetIndex=-1,this._speed=.1},o.setStopRequest=function(t,e){this._waitForReel=!0,this._targetIndex=t,this._speed=.08,this.fadeDuration=.15,this._onFinished=e},o.setHighSpeed=function(){this._speed=.02,this.fadeDuration=.3},o.update=function(t){this._isSpinning&&(this._timer+=t,this._timer>=this._speed&&(this._timer=0,this.stepNext()))},o.stepNext=function(){var t=this.currentIndex+1;t>=this.ringNodes.length&&(t=0),this.highlight(t);var e=this.ringNodes[this.currentIndex].getComponent(h).spriteFrame.name,i="icon ("+this._targetIndex+")";this._waitForReel&&e===i&&(this._isSpinning=!1,this._onFinished())},o.highlight=function(t){if(-1!==this.currentIndex&&this.ringNodes[this.currentIndex]){var e=this.ringNodes[this.currentIndex],i=e.getComponent(h);l.stopAllByTarget(e),l.stopAllByTarget(i),p(i).to(this.fadeDuration,{color:u.GRAY}).start()}if(this.currentIndex=t,this.ringNodes[t]){var n=this.ringNodes[t],r=n.getComponent(h);l.stopAllByTarget(n),l.stopAllByTarget(r),r.color=u.WHITE}},o.shuffleArray=function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1)),n=[t[i],t[e]];t[e]=n[0],t[i]=n[1]}},e}(d)).prototype,"ringNodes",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),y=e(m.prototype,"fadeDuration",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),_=m))||_));o._RF.pop()}}}));

System.register("chunks:///_virtual/SlotGameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RingController.ts","./ReelController.ts"],(function(t){var e,n,i,o,r,a,l,s,c,h,p,u,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,l=t.SpriteFrame,s=t.input,c=t.Input,h=t.KeyCode,p=t.Component},function(t){u=t.RingController},function(t){g=t.ReelController}],execute:function(){var S,m,f,y,d,C,b,I,_;r._RF.push({},"34800FezMNCKL2jptbHMWtu","SlotGameManager",void 0);var D=a.ccclass,N=a.property;t("SlotGameManager",(S=D("SlotGameManager"),m=N({type:[l],tooltip:"Data gốc: Danh sách toàn bộ icon"}),f=N(u),y=N(g),S((b=e((C=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(e,"symbolData",b,o(e)),i(e,"ringCtrl",I,o(e)),i(e,"reelCtrl",_,o(e)),e._targetSymbolId=-1,e._gameState="IDLE",e}n(e,t);var r=e.prototype;return r.onLoad=function(){s.on(c.EventType.KEY_DOWN,this.onKeyDown,this)},r.onDestroy=function(){s.off(c.EventType.KEY_DOWN,this.onKeyDown,this)},r.onKeyDown=function(t){switch(t.keyCode){case h.SPACE:this.onSpaceDown()}},r.start=function(){this.ringCtrl.initItems(this.symbolData),this.reelCtrl.initReel(this.symbolData)},r.onSpaceDown=function(){"IDLE"==this._gameState?this.onSpinClick():"SPINNING"==this._gameState&&this.onStopSpin()},r.onSpinClick=function(){"IDLE"===this._gameState&&(this._gameState="SPINNING",this.ringCtrl.startSpin(),this.reelCtrl.startSpin(),this.scheduleOnce(this.highSpeedRing,1))},r.highSpeedRing=function(){this.ringCtrl.setHighSpeed()},r.onStopSpin=function(){this._targetSymbolId=Math.floor(9*Math.random())+1,console.log("Symbol id win: "+this._targetSymbolId),this._gameState="STOPPING",this.reelCtrl.stopAt(this._targetSymbolId)},r.update=function(t){var e=this;"STOPPING"===this._gameState&&this.reelCtrl.isStopped&&(this._gameState="WAITING_FOR_RING",this.ringCtrl.setStopRequest(this._targetSymbolId,(function(){e.onGameFinished()})))},r.onGameFinished=function(){console.log("GAME OVER - WINNER!"),this._gameState="IDLE"},e}(p)).prototype,"symbolData",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),I=e(C.prototype,"ringCtrl",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(C.prototype,"reelCtrl",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=C))||d));r._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});